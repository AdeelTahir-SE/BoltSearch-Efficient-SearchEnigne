[
  {
    "Id": 15307230,
    "CreationDate": "2013-03-09T04:41:50Z",
    "Score": 5,
    "Title": "how to make case insensitive search",
    "Body": "<p>i am using jQuery <code>autocompleter</code> for searching.</p>\n\n<p>From my below code my search is happening only on case-sensitive , i want to make case insensitive search.\neg. <code>$array={the king, The king, The man}</code></p>\n\n<p>And my search keyword is \"The\" then currently I am getting only the output like <code>{The king, The man}</code>\nI am not getting <code>the king</code> because it is in lower case.</p>\n\n<p>what I want is ,if I write \"the\" then I should get all the three results.</p>\n\n<p>Please help me to solve my problem</p>\n\n<p>view.php</p>\n\n<pre><code>&lt;script type=\"text/javascript\"&gt;\n$(document).ready(function() {\n        $(function() {\n                $( \"#autocomplete\" ).autocomplete({\n\n\n                        source: function(request, response) {\n\n                     $.ajax({ url: \"&lt;?php echo base_url().'search/suggestions'?&gt;\",\n                                data: { term: $(\"#autocomplete\").val()},\n                                dataType: \"json\",\n                                type: \"POST\",\n                                success: function(data){\n\n                                        response(data);\n                                }\n                        });\n                },\n\n                minLength: 3,\n                select: function (a, b) {\n    $(this).val(b.item.value);\n    $(\".searchform1\").submit()\n}\n                });\n        });\n        $('#autocomplete').focus(); \n});\n\n\n  function monkeyPatchAutocomplete() {\n\n      // Don't really need to save the old fn, \n      // but I could chain if I wanted to\n      var oldFn = $.ui.autocomplete.prototype._renderItem;\n\n      $.ui.autocomplete.prototype._renderItem = function( ul, item) {\n          var re = new RegExp(\"^\" + this.term, \"i\") ;\n          var t = item.label.replace(re,\"&lt;span style='font-weight:bold;color:Black;'&gt;\" + this.term + \"&lt;/span&gt;\");\n          return $( \"&lt;li&gt;&lt;/li&gt;\" )\n              .data( \"item.autocomplete\", item )\n              .append( \"&lt;a&gt;\" + t + \"&lt;/a&gt;\" )\n              .appendTo( ul );\n      };\n  }\n\n\n  $(document).ready(function() {\n\n      monkeyPatchAutocomplete();\n\n      $(\"#input1\").autocomplete({\n          // The source option can be an array of terms.  In this case, if\n          // the typed characters appear in any position in a term, then the\n          // term is included in the autocomplete list.\n          // The source option can also be a function that performs the search,\n          // and calls a response function with the matched entries.\n          source: function(req, responseFn) {\n              addMessage(\"search on: '\" + req.term + \"'&lt;br/&gt;\");\n              var re = $.ui.autocomplete.escapeRegex(req.term);\n              var matcher = new RegExp( \"^\" + re, \"i\" );\n              var a = $.grep( wordlist, function(item,index){\n                  //addMessage(\"&amp;nbsp;&amp;nbsp;sniffing: '\" + item + \"'&lt;br/&gt;\");\n                  return matcher.test(item);\n              });\n              addMessage(\"Result: \" + a.length + \" items&lt;br/&gt;\");\n              responseFn( a );\n          },\n\n          select: function(value, data){\n              if (typeof data == \"undefined\") {\n                  addMessage('You selected: ' + value + \"&lt;br/&gt;\");\n              }else {\n                  addMessage('You selected: ' + data.item.value + \"&lt;br/&gt;\");\n              }\n          }\n      });\n  });\n&lt;/script&gt;\n     ---------------\n     ---------------\n        &lt;form class=\"searchform1\" action=\"&lt;?php echo base_url().'search/searchresult/pgn/grid/'?&gt;\" method=\"POST\"&gt; \n                        &lt;img src=\"&lt;?php echo base_url()?&gt;css/images/icons/searchicon.png\" style=\"vertical-align:middle;\"/&gt;  \n                        &lt;input id=\"autocomplete\" value=\"&lt;?php  if(isset($srchvalue)){echo $srchvalue ;} ?&gt;\" class=\"deletable\"   type=\"text\" name=\"keywords\" style=\"height: 30px;width: 450px;font-size: 16px;border: 0;border-bottom:solid 4px #dfdfdf;border-top:solid 4px #dfdfdf;\"  maxlength=\"70\" placeholder=\"  Search for Title, Author Name, Isbn , Publisher\"/&gt;\n\n                        &lt;input type=\"submit\" value=\"&amp;nbsp;&amp;nbsp;Search&amp;nbsp;&amp;nbsp;\" class=\"searchbtn\"/&gt;\n       &lt;/form&gt; \n</code></pre>\n",
    "Tag": "php,mysql,codeigniter",
    "Answer": "<p>Avoid using alot of like operators. Full text search is the way to go. Full txtsearch are case-insensitive by default. So you will have no problem with that.</p>\n\n<p>Here is how to integrate mysql fulltext with codeigniter</p>\n\n<p><a href=\"http://stackoverflow.com/questions/11762051/using-match-and-against-in-mysql-and-codeigniter\">Using Match and Against in MySQL and CodeIgniter</a></p>\n,,,,,<p>Do you intentionally use a case sensitive collation on your table? Changing to a case insensitive collation would solve your problem. Another solution would be to match your string in lower (or upper) case. Something like this:</p>\n\n<p>$this->db->or_like('LOWER(auth_lastname)', strtolower($keyword));</p>\n\n<p>Also, full text search is not possible if you use InnoDB as storage engine in mysql</p>\n",
    "combined_token_ids": "63853#, 21183#, 127886#, 129620#, 2460834#, 406668#, 61336, 262206, 2417491",
    "occurrence": 1
  },
  {
    "Id": 1719500,
    "CreationDate": "2009-11-12T02:23:09Z",
    "Score": 2,
    "Title": "In C#, what's the best way to search a list of a class by one of the class's members?",
    "Body": "<p>Say I have a class that looks something like this:</p>\n\n<pre><code>class SomeClass {\n    int m_member;\n\n    public int Member {\n        get { return m_member; }\n        set { m_member = value; }\n    }\n}\n</code></pre>\n\n<p>And somewhere else, I have a list of type <code>List&lt;SomeClass&gt; list</code>.</p>\n\n<p>If I want to search the list for a particular instance of the class, I can just do</p>\n\n<pre><code>int index = list.IndexOf(someInstance);\n</code></pre>\n\n<p>But if I want to search the list by Member, I have to do this:</p>\n\n<pre><code>int index = -1;\nfor (int i = 0; i &lt; list.Count; i++) {\n    if (list[i].Member == someMember) {\n        index = i;\n        break;\n    }\n}\n</code></pre>\n\n<p>Is there a better way to do this?</p>\n",
    "Tag": "c#,search,list",
    "Answer": "<pre><code>int index = list.FindIndex(m =&gt; m.Member == someMember);\n</code></pre>\n,,,,,<p>If you can use Linq</p>\n\n<pre><code>SomeClass aClasss = list.FirstOrDefault(item =&gt; item.Member == someMember);\n</code></pre>\n,,,,,<p>You can have an extended search method(using reflection) for the list like below where property name and search value are input parameters.</p>\n\n<pre><code>public static List&lt;T&gt; SearchList&lt;T&gt;(this List&lt;T&gt; list, string PropertyName, string SearchValue)\n{\n    return list.Select(item =&gt;\n        new\n        {\n            i = item,\n            Props = item.GetType().GetProperties(BindingFlags.Instance | BindingFlags.Public)\n        })\n        .Where(item =&gt; item.Props.Any(p =&gt;\n        {\n            var val = p.GetValue(item.i, null);\n            return val != null\n                &amp;&amp; (p.Name.ToLower() == PropertyName.ToLower() || string.IsNullOrEmpty(PropertyName))\n                &amp;&amp; (val.ToString().ToLower().Contains(SearchValue.ToLower()) || string.IsNullOrEmpty(SearchValue));\n        }))\n        .Select(item =&gt; item.i)\n        .ToList();\n    }\n</code></pre>\n\n<p>calling:</p>\n\n<pre><code>List&lt;Employee&gt; employees = new List&lt;Employee&gt;();\nvar searchedEmployees = data.SortList(serachProperty, searchValue);\n</code></pre>\n",
    "combined_token_ids": "20365#, 3168#, 134604#, 58632#, 137946#, 63205#, 21183#, 406668#, 3104#, 140192#, 19743#, 254889#, 21299#, 59284#, 413366#, 3168, 406668, 140192",
    "occurrence": 1
  },
  {
    "Id": 33939470,
    "CreationDate": "2015-11-26T13:04:06Z",
    "Score": 1,
    "Title": "android show search history in setOnSearchClickListener",
    "Body": "<p>i wanna show all search history when user click on searchView.(on setOnSearchClickListener), but my codes cannot show history in setOnSearchClickListener(it just shows my toast). it works well in onQueryTextChange. but i want it in setOnSearchClickListener. please help me.</p>\n\n<pre><code>searchView.setOnSearchClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                Toast.makeText(mActivity,\"hello\",Toast.LENGTH_LONG).show();\n                if (database != null) {\n                    Cursor cursor = database.getAllSuggestions();\n                    Log.d(\"cursor= \",cursor+\"\");\n                    if (cursor.getCount() != 0) {\n                        String[] columns = new String[]{SuggestionsDatabase.FIELD_SUGGESTION};\n                        int[] columnTextId = new int[]{android.R.id.text1};\n\n                        SuggestionSimpleCursorAdapter simple = new SuggestionSimpleCursorAdapter(mActivity.getBaseContext(),\n                                R.layout.simple_list_item, cursor,\n                                columns, columnTextId\n                                , 0);\n\n                        searchView.setSuggestionsAdapter(simple);\n                    } else {\n\n                    }\n                }\n            }\n        });\n</code></pre>\n",
    "Tag": "android",
    "Answer": null,
    "combined_token_ids": "642623#, 140817#, 406668#, 697139#, 20365#, 23871579#, 642623",
    "occurrence": 1
  },
  {
    "Id": 28153150,
    "CreationDate": "2015-01-26T15:24:53Z",
    "Score": 0,
    "Title": "Search on Custom ListView Android error",
    "Body": "<p>I have app where I should implement search on Custom List so I have error when I type any key on edittext<code>01-26 21:19:11.441: E/AndroidRuntime(5793): FATAL EXCEPTION: main\n01-26 21:19:11.441: E/AndroidRuntime(5793): java.lang.IndexOutOfBoundsException: Invalid index 2, size is 2\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at java.util.ArrayList.throwIndexOutOfBoundsException(ArrayList.java:251)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at java.util.ArrayList.get(ArrayList.java:304)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at com.tutecentral.navigationdrawer.CustomList.getView(CustomList.java:52)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.widget.AbsListView.obtainView(AbsListView.java:2054)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.widget.ListView.measureHeightOfChildren(ListView.java:1476)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.widget.ListView.onMeasure(ListView.java:1339)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.view.View.measure(View.java:12948)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.view.ViewGroup.measureChildWithMargins(ViewGroup.java:5005)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.widget.LinearLayout.measureChildBeforeLayout(LinearLayout.java:1369)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.widget.LinearLayout.measureVertical(LinearLayout.java:660)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.widget.LinearLayout.onMeasure(LinearLayout.java:553)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.view.View.measure(View.java:12948)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.view.ViewGroup.measureChildWithMargins(ViewGroup.java:5005)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.widget.FrameLayout.onMeasure(FrameLayout.java:293)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.view.View.measure(View.java:12948)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.support.v4.widget.DrawerLayout.onMeasure(DrawerLayout.java:762)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.view.View.measure(View.java:12948)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.view.ViewGroup.measureChildWithMargins(ViewGroup.java:5005)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.widget.FrameLayout.onMeasure(FrameLayout.java:293)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.view.View.measure(View.java:12948)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.widget.LinearLayout.measureVertical(LinearLayout.java:812)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.widget.LinearLayout.onMeasure(LinearLayout.java:553)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.view.View.measure(View.java:12948)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.view.ViewGroup.measureChildWithMargins(ViewGroup.java:5005)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.widget.FrameLayout.onMeasure(FrameLayout.java:293)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at com.android.internal.policy.impl.PhoneWindow$DecorView.onMeasure(PhoneWindow.java:2141)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.view.View.measure(View.java:12948)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.view.ViewRootImpl.performTraversals(ViewRootImpl.java:1227)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.view.ViewRootImpl.handleMessage(ViewRootImpl.java:2695)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.os.Handler.dispatchMessage(Handler.java:99)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.os.Looper.loop(Looper.java:156)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at android.app.ActivityThread.main(ActivityThread.java:4987)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at java.lang.reflect.Method.invokeNative(Native Method)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at java.lang.reflect.Method.invoke(Method.java:511)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:784)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:551)\n01-26 21:19:11.441: E/AndroidRuntime(5793):     at dalvik.system.NativeStart.main(Native Method)\n</code></p>\n\n<p>My activity:`</p>\n\n<pre><code>public class MyLibrary extends Fragment {\nListView listview;\nList&lt;ParseObject&gt; ob;\nProgressDialog mProgressDialog;\nArrayAdapter&lt;String&gt; adapter2;\nCustomList adapter;\nEditText inputSearch;\nint textlength = 0;\n\npublic MyLibrary() {\n\n}\n\n@Override\npublic View onCreateView(LayoutInflater inflater, ViewGroup container,\n        Bundle savedInstanceState) {\n    Parse.initialize(getActivity(),\n            \"ASD\",\n            \"ASD\");\n    ParseUser.enableAutomaticUser();\n    ParseACL defaultACL = new ParseACL();\n    defaultACL.setPublicReadAccess(true);\n    ParseACL.setDefaultACL(defaultACL, true);\n    View view = inflater.inflate(R.layout.getnewlay, container, false);\n\n    new RemoteDataTask().execute();\n\n    return view;\n}\n\nprivate class RemoteDataTask extends AsyncTask&lt;Void, Void, Void&gt; {\n    @Override\n    protected void onPreExecute() {\n        super.onPreExecute();\n        mProgressDialog = new ProgressDialog(getActivity());\n        mProgressDialog.setTitle(\"Parse.com Simple ListView Tutorial\");\n        mProgressDialog.setMessage(\"Loading...\");\n        mProgressDialog.setIndeterminate(false);\n        mProgressDialog.show();\n    }\n\n    @Override\n    protected Void doInBackground(Void... params) {\n        // Locate the class table named \"Country\" in Parse.com\n        ParseQuery query = new ParseQuery(\"BookStore\");\n        query.orderByDescending(\"_created_at\");\n        try {\n            ob = query.find();\n            Log.e(\"Yes\", \"\" + ob);\n\n        } catch (ParseException e) {\n            Log.e(\"Error\", e.getMessage());\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n    @Override\n    protected void onPostExecute(Void result) {\n\n        listview = (ListView) getView().findViewById(R.id.listviewget);\n        inputSearch = (EditText) getView().findViewById(R.id.inputSearch);\n        adapter = new CustomList(getActivity(), ob);\n\n        /*\n         * ArrayAdapter&lt;String&gt;(getActivity(), R.layout.listview_item);\n         */\n        // Retrieve object \"name\" from Parse.com database\n        for (ParseObject country : ob) {\n            adapter.add((String) country.get(\"name\"));\n        }\n        listview.setAdapter(adapter);\n        inputSearch.addTextChangedListener(new TextWatcher() {\n            ArrayList&lt;String&gt; text_sort = new ArrayList&lt;String&gt;();\n\n            @Override\n            public void afterTextChanged(Editable arg0) {\n\n            }\n\n            @Override\n            public void beforeTextChanged(CharSequence arg0, int arg1,\n                    int arg2, int arg3) {\n\n            }\n\n            @Override\n            public void onTextChanged(CharSequence cs, int arg1, int arg2,\n                    int arg3) {\n            //adapter.getFilter().filter(cs.toString());\n                String text = inputSearch.getText().toString()\n                        .toLowerCase(Locale.getDefault());\n                adapter.filter(text);\n                /*\n                 * adapter.getFilter().filter(cs.toString()); textlength =\n                 * inputSearch.getText().length(); text_sort.clear();\n                 */\n                // image_sort.clear();\n\n                /*\n                 * for (int i = 0; i &lt; text_sort.size(); i++) { if\n                 * (textlength &lt;= ob.get(i).size()) { if\n                 * (edittext.getText().toString(). equalsIgnoreCase((String)\n                 * text[i].subSequence(0, textlength))) {\n                 * text_sort.add(text[i]); image_sort.add(image[i]); } }\n                 */\n\n            }\n        });\n        mProgressDialog.dismiss();\n\n        /*\n         * listview.setOnItemClickListener(new OnItemClickListener() {\n         * \n         * @Override public void onItemClick(AdapterView&lt;?&gt; parent, View\n         * view, int position, long id) { // Send single item click data to\n         * SingleItemView Class // Intent i = new Intent(GetNewBooks.this,\n         * // SingleItemView.class); // Pass data \"name\" followed by the\n         * position // i.putExtra(\"name\", ob.get(position).getString(\"name\")\n         * // .toString()); // Open SingleItemView.java Activity //\n         * startActivity(i); } });\n         */\n    }\n}\n\n\n}\n</code></pre>\n\n<p>AdapretClass:</p>\n\n<pre><code>public class CustomList extends ArrayAdapter &lt; String &gt; {\nprivate finalActivity context;\n/*private final String[] web;\nprivate final String[] descr;\nprivate final Integer[] imageId;\nprivate final Integer[] imagId;*/\nprivate List &lt; ParseObject &gt; ob = null;\n//  private final String[] descr;\n// public CustomList(Activity context, List&lt;ParseObject&gt;\n// ob,List&lt;ParseObject&gt; ob2) {\n// }\nprivate ArrayList &lt; ParseObject &gt; arraylist;\npublic CustomList(Activity context, List &lt; ParseObject &gt; ob) {\n    super(context, R.layout.list_single);\n    this.ob = ob;\n    this.context = context;\n    this.arraylist = new ArrayList &lt; ParseObject &gt; ();\n    this.arraylist.addAll(ob);\n    //  this.descr = ob;\n    /*this.descr = ob2;\n    this.web = ob;\n    this.imageId = imageId;\n    this.imagId = imagId;*/\n    // TODO Auto-generated constructor stub\n}\n\n@Override\npublic View getView(int position, View view, ViewGroup parent) {\n    LayoutInflater inflater = context.getLayoutInflater();\n    View rowView = inflater.inflate(R.layout.list_single, null, true);\n    TextView txtTitle = (TextView) rowView.findViewById(R.id.lname);\n    //for(ParseObject i : ob) txtTitle.setText((CharSequence) i);\n    txtTitle.setText(ob.get(position).get(\"name\").toString());\n    return rowView;\n}\n\npublic void filter(String charText) {\n    charText = charText.toLowerCase(Locale.getDefault());\n    ob.clear();\n    if (charText.length() == 0) {\n        ob.addAll(arraylist);\n    } else {\n        for (ParseObject wp: arraylist) {\n            if (((String) wp.get(\"name\")).toLowerCase(Locale.getDefault())\n                .contains(charText)\n            ) {\n                ob.add(wp);\n            }\n        }\n    }\n    notifyDataSetChanged();\n}\n}\n</code></pre>\n",
    "Tag": "android,android-layout,android-listview",
    "Answer": "<p>Of course you got <code>IndexOutOfBoundsException</code> exception. Why?\n<br>1. Your <code>CustomList</code> is <b><code>String</code></b> <code>ArrayAdapter</code> and you initialize number of item in your adapter as below: </p>\n\n<pre><code>for (ParseObject country : ob) {\n    adapter.add((String) country.get(\"name\"));\n}\n</code></pre>\n\n<p>--> that means your <code>adapter</code> has <code>ob.size()</code> = 2 items, right?\n<br>2. After you <code>filter</code> your adapter, your <code>ob.size()</code> is changed (smaller than 2 item, I guest) however, your <code>String</code> <code>ArrayAdapter</code> doesn't change (still has 2 items) --> the <code>getView()</code> function will throw in line <code>txtTitle.setText(ob.get(position).get(\"name\").toString());</code></p>\n\n<p>If you want to solve it change your <code>filter</code> as below:</p>\n\n<pre><code> public void filter(String charText) {\ncharText = charText.toLowerCase(Locale.getDefault());\nob.clear();\nthis.clear(); // clear the adapter too.\n\nif (charText.length() == 0) {\n    ob.addAll(arraylist);\n} else {\n    for (ParseObject wp: arraylist) {\n        if (((String) wp.get(\"name\")).toLowerCase(Locale.getDefault())\n            .contains(charText)\n        ) {\n            ob.add(wp);\n            this.add((String)wp.get(\"name\")); // add item to your adapter.            \n        }\n    }\n}\nnotifyDataSetChanged();\n}\n</code></pre>\n\n<p>P/s: Your adapter is really ugly. You should learn how to reuse in <code>getView</code>. It will improve your list scroll performance a lot.</p>\n",
    "combined_token_ids": "406668#, 20743#, 437953#, 994375#, 642623#, 261729#, 642623, 4804964, 7153989",
    "occurrence": 1
  },
  {
    "Id": 14989570,
    "CreationDate": "2013-02-20T20:44:33Z",
    "Score": -1,
    "Title": "PHP/MySQL table search by Perl",
    "Body": "<p>With not understanding perl/MySQL enough IÃ¢ÂÂm hoping someone here can give a helping hand.\nThe code obviously doesn't work, but it's what I have so far and I'm still learning.</p>\n\n<p>IÃ¢ÂÂm wanting to open and search a database for the <code>$ticket_id</code> obtained from a php page and get one or both of either the email address and/or phone email if one is there for that <code>$ticket_id</code>. There will be at least one.</p>\n\n<p>Since I seem to be asked this every once a while. (This is not a school project. IÃ¢ÂÂve been out of school since 75).</p>\n\n<p>I have the script working with out the database lookup of the information but I have to hand code each setup with the ticket_id and email address(s). Glad I only have 5 people using this, but have been getting asked by others that would like to use it. So I think this would be a good time to stream line the process to use a MySQL database that way if I ever got busy with it, I wouldnÃ¢ÂÂt have to work to much beyond filling out a form page to add their info.</p>\n\n<p>In the database needing to search there is 3 tables, I need to search for the ticket_id and then get the username that is their email address and/or the phone-email but either could be empty depending on the type of notice they want.</p>\n\n<p>This can be changed anyway needed. It only has one record in it to work with this new setup.</p>\n\n<pre><code>username:  email(at)address(dot)com\nticket_id: 1-YS25UHRN3N9D\nphone: 1234567890(at)cellphone(dot)com\n</code></pre>\n\n<p>I was told this could be done with JavaScript window.onload so changing HTML page to PHP would not be needed but donÃ¢ÂÂt know JavaScript at all.</p>\n\n<p>The echo script might be wrong. <code>$pg</code> is received fine by the script at this time with no <code>echo</code> of it needed.</p>\n\n<p>Top of PHP page</p>\n\n<pre><code>&lt;?php\n  $ip = $_SERVER['REMOTE_ADDR']; // Client IP address\n  $pg = $_SERVER['HTTP_REFERER']; // What page did they view\n  $ticket_id = '1-YS25UHRN3N9D'; // Ticket id\n  $message = '1'; // 1=email, 2=text, 3=email &amp; text\n  $url = \"/cgi-bin/log_it.cgi\"; // back-end url\necho '&lt;script type=\"text/javascript\" src=\"' . $url . '?id=' . $id . '&amp;amp;ip=' . $ip \n.  '?ticket_id=' . $ticket_id . ' . '?message=' . $message . '\"&gt;&lt;/script&gt;';\n?&gt;\n</code></pre>\n\n<p>I was told putting the database login information in the cgi was bad, but I donÃ¢ÂÂt know how to work it into a php file and access the file from perl or other way.</p>\n\n<pre><code>#!/usr/bin/perl -W\n\nuse CGI;\nuse CGI param;\nuse POSIX qw/strftime/;\n\n# database\n$host = \"localhost\";\n$database = \"users\";\n$tablename = \"tickets\";\n$user = \"username\";\n$pw = \"password\";\n\n# Obtain $id &amp; $ip from web page.\n$id = param(\"ticket_id\");\n$ip = param(\"ip\");\n\n# message\n# 1 = email\n# 2 = phone\n# 3 = both\n$message = param(\"message\");\n\n# Connect to database\n$connect = Mysql-&gt;connect($host, $database, $user, $pw);\n\n# DB\n$connect-&gt;selectdb($database);\n\n# MySQL QUERY\n$myquery = \"SELECT ticket_id FROM user\";\n\n# QUERY\n$myquery = \"SELECT ticket_id FROM $tablename\";\n\n# Need to be worked on.\n# If record not found.\n#\n#  \"To Do\" send a page or popup if the id is not valid.\n#    $file = \"/var/log/invalid_id_iptrace.txt\";\n#    open(FILE, \"&gt;$file\");\n#   print FILE strftime(\"%A %B %d, %Y - %I:%M %p %Z\\n\", localtime(time) );\n#    print FILE \" -- IP Address: $ip\\n\\t Accessed unknown $id:\\n------\\n\";\n#    close(FILE);\n#    system(\"mail -s 'Page visited Unknown' admin\\@mydomain.com \\&lt; /var/log\n#    /invalid_id_iptrace.txt\");\n# exit();\n\n#check if we have a matching $id == $ticket_id\nif ($id =~ /$ticket_id/) {\n\n #if we have a match open the file to write.\n $file = \"/var/log/$ticket_id_iptrace.txt\";\n open(FILE, \"&gt;$file\");\n\n # lets put the time in the file.\n print FILE strftime(\"%A %B %d, %Y - %I:%M %p %Z\\n\", localtime(time) );\n\n # put the IP address and web page visited.\n print FILE \" -- IP Address: $ENV{REMOTE_ADDR}\\n\\t Accessed your page:\n $ENV{HTTP_REFERER}\\n------\\n\";\n print FILE \" -- Here is the IP information we found:\\n------\\n\";\n\n #close the file. Finished with the first part\n close(FILE);\n\n # Run the IP2Location script.\n system(\"./iptrace.sh $ENV{REMOTE_ADDR} json city&gt;&gt;/var/log/$ticket_id_iptrace.txt\");\n\n # Lets send an email and or text with all the information.\n\n # Send email\n if($message =~ /1/) {\n  system(\"mail -s 'Web Page visited' $username \\&lt; /var/log/$ticket_id_iptrace.txt\");\n }\n\n # Send text\n if($message =~ /2/) {\n  system(\"mail -s 'Web Page visited' $phone \\&lt; /var/log/$ticket_id_iptrace.txt\");\n }\n\n # Send email and text message\n if($message =~/3/) {\n  system(\"mail -s 'Web Page visited' $username \\&lt; /var/log/$ticket_id_iptrace.txt\");\n  system(\"mail -s 'Web Page visited' $phone \\&lt; /var/log/$ticket_id_iptrace.txt\");\n }\n exit();\n }\n\nexit();\n#end of script\n</code></pre>\n\n<p>Thank you</p>\n\n<p><strong>Update:</strong> Second (cleaned up) version of code:</p>\n\n<pre><code>#!/usr/bin/perl\nuse warnings;\nuse strict;\nuse CGI qw/param/;\nuse DBI();\n\n# database\nmy $host = \"remotehost\";\nmy $database = \"database\";\nmy $tablename = \"table\";\nmy $user = \"user\";\nmy $pw = \"pwd\";\n\n# Obtain $id &amp; $ip from web page.\nmy $id = param(\"id\");\nmy $ip = param(\"ip\");\nmy $ticket_id = \"ticket_id\";\nmy $file = \"/tmp/_iptrace.txt\";\nmy $fileb = \"/tmp/invalid_id_iptrace.txt\";\nmy $fh = \"FILE\";\nmy $phone = \"phone\";\nmy $username = \"username\";\n# message\n# 1 = email\n# 2 = phone\n# 3 = both\nmy $message = param(\"message\");\n\n# Connect to database\nmy $connect = Mysql-&gt;connect($host, $database, $user, $pw);\n\n# DB\n$connect-&gt;selectdb($database);\n\n # QUERY\nmy $myquery = \"SELECT ticket_id FROM $tablename\";\n\n# EXECUTE\nmy $execute = $connect-&gt;query($myquery);\n\n#check if we have a matching $id == $ticket_id\nif ($id == $payer_id) {\n#if we have a match open the file to write.\nopen(my $fh, '&gt;', $file) or die $!;\n\n# lets put the time in the file.\nprint $fh strftime(\"%A %B %d, %Y - %I:%M %p %Z\\n\", localtime(time) );\n\n# put the IP address and web page visited.\nprint $fh \" -- IP Address: $ENV{REMOTE_ADDR}\\n\\t Accessed your page:\n    $ENV{HTTP_REFERER}\\n------\\n\";\nprint $fh \" -- Here is the information we found:\\n------\\n\";\n\n#close the file. Finished with the first part\nclose($fh);\n\n# Run the IP2Location script.\nsystem(\"./iptrace.sh $ENV{REMOTE_ADDR} json city&gt;&gt;/tmp/$ticket_id$file\");\n\n# Lets send an email and or text with all the information.\n# Send email\n    if($message == 1) {\n    system(\"mail -s 'Web Page visited' $username \\&lt; /tmp/$ticket\n            _id$file\");\n    }\n    # Send text\n    if($message == 2) {\n    system(\"mail -s 'Web Page visited' $phone \\&lt; /tmp/$ticket\n            _id$file\");\n}\n# Send email and text message\nif($message == 3) {\n    system(\"mail -s 'Web Page visited' $username \\&lt; /tmp/$ticket\n            _id$file\");\n    system(\"mail -s 'Web Page visited' $phone \\&lt; /tmp/$ticket\n            _id$file\");\n    }\nexit();\n}\n#  \"To Do\" send a page or popup if the id is not valid.\n\nopen($fh, \"&gt;$fileb\");\nprint $fh strftime(\"%A %B %d, %Y - %I:%M %p %Z\\n\", localtime(time) );\nprint $fh \" -- IP Address: $ip\\n\\t Accessed unknown $id:\\n------\\n\";\nclose($fh);\nsystem(\"mail -s 'Page visited Unknown' admin\\@mydomain.com \\&lt;\n/tmp/invalid_id_iptrace.txt\");\n\nexit();\n#end of script\n</code></pre>\n",
    "Tag": "php,mysql,perl",
    "Answer": "<p>There doesn't seem to be a question in your post. You say \"the code obviously doesn't work\", but you don't tell us what kind on unexpected behaviour you're seeing. So here are some comments on your code. One of them might address the issue.</p>\n\n<p>1/ It should be '-w' on the shebang line, not '-W'. In fact these days you should just remove '-w' and include <code>use warnings;</code> just below the shebang line.</p>\n\n<p>2/ You should also add <code>use strict;</code> just below <code>use warnings;</code>. This will appear to completely break your program as it will insist on you predeclaring all of your variables - which you do using <code>my</code> (<code>my $host = 'localhost'</code>, etc). This will be a pain at first, but it's a really good habit to get into.</p>\n\n<p>3/ You only need one <code>use CGI</code> line. And it should be <code>use CGI qw/param/;</code>.</p>\n\n<p>4/ You're using a class called Mysql. But you don't load that class anywhere. Where does that class come from? You should really be using a combination of <a href=\"https://metacpan.org/module/DBI\" rel=\"nofollow\">DBI</a> and <a href=\"https://metacpan.org/module/DBD%3a%3amysql\" rel=\"nofollow\">DBD::mysql</a>.</p>\n\n<p>5/ You put an SQL query into <code>$mysquery</code> but then you immediately overwrite it with another one. That's not going to cause an error - it's probably just a indication of some confusion on your part.</p>\n\n<p>6/ Your <code>if ($id =~ /$ticket_id/)</code> is almost certainly better written as <code>if ($id == $ticket_id)</code>. No need to use regular expressions if you're just comparing two numbers.</p>\n\n<p>7/ You should really check the return value from your call to <code>open</code>.</p>\n\n<pre><code>open(FILE, \"&gt;$file\") or die $!;\n</code></pre>\n\n<p>In fact, I'd rewrite that to use 3-arg open and an autovivified filehandle.</p>\n\n<pre><code>open(my $fh, '&gt;', $file) or die $!;\n</code></pre>\n\n<p>You'll then need to change <code>FILE</code> to <code>$fh</code> throughout the code.</p>\n\n<p>8/ Again, your three comparisons against <code>$message</code> can just be simple <code>==</code> matches rather than using regex matching.</p>\n\n<p>If you're going to be doing a lot of this, then I really recommend reading a good book like \"Learning Perl\" or \"Beginning Perl\".</p>\n",
    "combined_token_ids": "1339025#, 239375#, 406668#, 21299#, 135347#, 61336, 262206, 135347",
    "occurrence": 1
  }
]
